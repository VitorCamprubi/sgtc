<section class="groups-page">
  <header class="section-header">
    <div>
      <p class="breadcrumbs">
        <a routerLink="/login">Login</a>
        <span aria-hidden="true">/</span>
        <span>Grupos</span>
      </p>
      <h2>Grupos</h2>
      <p class="section-subtitle">
        Acompanhe os grupos cadastrados e gerencie novas turmas quando necessario.
      </p>
    </div>
    <button type="button" class="ghost-button" (click)="carregarMeus()">Atualizar lista</button>
  </header>

  @if (error()) {
    <p class="error-banner">Erro: {{ error() }}</p>
  }

  @if (isAdmin()) {
    <section class="card admin-card">
      <div class="card-header">
        <h3>Admin - Criar novo grupo</h3>
      </div>
      <div class="form-grid">
        <input placeholder="Titulo" [(ngModel)]="novoTitulo" />
        <select [(ngModel)]="novoOrientadorId">
          <option [ngValue]="null">Selecione orientador</option>
          @for (u of orientadores(); track u.id) {
            <option [ngValue]="u.id">{{ u.nome }}</option>
          }
        </select>
        <select [(ngModel)]="novoCoorientadorId">
          <option [ngValue]="null">Coorientador (opcional)</option>
          @for (u of orientadores(); track u.id) {
            <option [ngValue]="u.id">{{ u.nome }}</option>
          }
        </select>
        <button type="button" (click)="criarGrupo()">Criar</button>
      </div>
    </section>
  }

  <section class="card">
    <div class="card-header compact">
      <h3>Meus grupos</h3>
      @if (grupos()) {
        <span class="pill-count">{{ grupos()?.length ?? 0 }}</span>
      }
    </div>

    @if (grupos() === null) {
      <p class="state-info">Carregando...</p>
    } @else {
      @if (grupos()?.length === 0) {
        <p class="state-info">Nenhum grupo encontrado.</p>
      } @else {
        <div class="table-wrapper">
          <table class="groups-table">
            <thead>
              <tr>
                <th>ID</th>
                <th>Titulo</th>
                <th>Orientador</th>
                <th>Coorientador</th>
                <th>Membros</th>
                @if (isAdmin()) { <th>Acoes</th> }
              </tr>
            </thead>
            <tbody>
              @for (g of grupos()!; track g.id) {
                <tr>
                  <td>{{ g.id }}</td>
                  <td><a [routerLink]="['/grupos', g.id]">{{ g.titulo }}</a></td>
                  <td>{{ g.orientadorNome || '-' }}</td>
                  <td>{{ g.coorientadorNome || '-' }}</td>
                  <td class="members-count">{{ g.totalMembros }}</td>
                  @if (isAdmin()) {
                    <td>
                      <button type="button" class="ghost-button danger"
                              [disabled]="deletando() === g.id"
                              (click)="excluirGrupo(g.id, g.titulo)">
                        {{ deletando() === g.id ? 'Excluindo...' : 'Excluir' }}
                      </button>
                    </td>
                  }
                </tr>
              }
            </tbody>
          </table>
        </div>
      }
    }
  </section>
</section>
